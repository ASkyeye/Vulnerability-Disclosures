# CVE-2021-AVST1.1

## Description

AvastSvc exposes RPC-interface, named *"Aavm"* with uuid *eb915940-6276-11d2-b8e7-006097c59f07*, which
contains method *Proc80* that allows trusted (in terms of self-defense) restricted user to delete arbitrary 
file without impersonation. Vulnerable pseudocode is shown below:

```
DWORD Proc80_AavmDeleteFile(void *contextHandle, const WCHAR *filePath)
{
  if ( !dword_1806E3F7C )
    return -2147196160;
  if ( DeleteFileW(filePath) )
    return 0;
  return GetLastError();
}
```

## Impact

Local privilege escalation vulnerability in Avast Free Antivirus prior to 20.4 allows a restricted user 
to remove arbitrary file/directory in "NT Authority\System" context.

## Steps to reproduce

1. Run *rundll32.exe AavmArbitraryFileDeleteExploit.dll,Exploit*;
2. Observe that the file *C:\Windows\System32\drivers\pci.sys* has been deleted.

## Resolution

This issue fixed since Avast 20.4.

## Disclosure Timeline

25-03-2020 Initial report sent to Avast.

26-03-2020 Initial response from Avast stating theyâ€™re being reviewed it.

23-04-2020 Avast triaged the issue reported as a valid issue and is starting work on a fix.

03-06-2020 Avast released patched version of product.

## References

CVE-2021-AVST1.1

[Avast Hall of Fame](https://www.avast.com/hacker-hall-of-fame/en/researcher-david-eade-reports-antitrack-bug-to-avast-0)
