#include "pch.h"
#include "ComUtils.h"
#include "wil/win32_helpers.h"
#include <objbase.h>
#include <stdio.h>
#include <stdexcept>

namespace utils::com
{

std::string CreateGuid()
{
    GUID guid;

    const auto hr = ::CoCreateGuid(&guid);
    if (!SUCCEEDED(hr))
        throw std::runtime_error("CoCreateGuid failed. Error: " + std::to_string(hr));

    char guidBuffer[wil::guid_string_buffer_length];
    sprintf_s(
        guidBuffer, "{%08lX-%04hX-%04hX-%02hhX%02hhX-%02hhX%02hhX%02hhX%02hhX%02hhX%02hhX}",
        guid.Data1, guid.Data2, guid.Data3,
        guid.Data4[0], guid.Data4[1], guid.Data4[2], guid.Data4[3],
        guid.Data4[4], guid.Data4[5], guid.Data4[6], guid.Data4[7]);

    return guidBuffer;
}

}
